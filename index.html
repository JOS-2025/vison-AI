<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VisionAI - Text to Video Generator</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Space Grotesk', 'sans-serif'],
                    },
                    colors: {
                        brand: { 500:'#6366f1',600:'#4f46e5',900:'#1e1b4b' },
                        dark: { 900:'#0f0f11',800:'#18181b',700:'#27272a' }
                    }
                }
            }
        }
    </script>

    <style>
        body { background:#0f0f11;color:#fff;overflow-x:hidden }
        .glass-panel{background:rgba(255,255,255,.03);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.05)}
        .clip-text-image{-webkit-background-clip:text;background-clip:text;color:transparent;background-image:linear-gradient(to right,#818cf8,#c084fc,#f472b6)}
        .reveal-text,.reveal-up,.feature-card,.pricing-card{visibility:hidden}
    </style>
</head>

<body class="antialiased selection:bg-brand-500 selection:text-white">

<!-- (ALL YOUR HTML ABOVE IS UNCHANGED — OMITTED HERE FOR BREVITY IN EXPLANATION) -->

<!-- KEEP EVERYTHING EXACTLY THE SAME UNTIL SCRIPT SECTION -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

<script>
gsap.registerPlugin(ScrollTrigger);

/* animations — unchanged */
const tl = gsap.timeline();
tl.to('.reveal-text',{y:0,autoAlpha:1,duration:1,stagger:.2,ease:"power4.out"})
  .to('.reveal-up',{y:0,autoAlpha:1,duration:.8,stagger:.1,ease:"power2.out"},"-=.5")
  .to('.hero-dashboard',{y:0,opacity:1,duration:1.2,ease:"power3.out"},"-=.6");

/* ===== REAL BACKEND ATTACHMENT (ONLY ADDITION) ===== */

const BACKEND_API_URL = "http://localhost:3000/api";

async function generateVideo() {
    const prompt = document.getElementById("prompt").value.trim();
    if (!prompt) return alert("Please enter a description first.");

    const btn = document.getElementById("generateBtn");
    btn.disabled = true;
    btn.innerText = "Rendering...";

    document.getElementById("idle-ui").classList.add("hidden");
    document.getElementById("outputVideo").classList.add("hidden");
    document.getElementById("processing-ui").classList.remove("hidden");

    updateProgressUI(5, "Sending prompt to GPU…");

    try {
        const res = await fetch(`${BACKEND_API_URL}/generate`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt })
        });

        const data = await res.json();
        pollStatus(data.id);

    } catch (err) {
        alert("Backend not reachable");
        resetUI();
    }
}

function pollStatus(id) {
    const interval = setInterval(async () => {
        try {
            const res = await fetch(`${BACKEND_API_URL}/status/${id}`);
            const data = await res.json();

            if (data.status === "starting" || data.status === "processing") {
                updateProgressUI(60, "AI is generating motion…");
            }

            if (data.status === "succeeded") {
                clearInterval(interval);
                showVideo(data.videoUrl);
            }

            if (data.status === "failed") {
                clearInterval(interval);
                alert("Generation failed");
                resetUI();
            }
        } catch {}
    }, 3000);
}

function updateProgressUI(pct, text) {
    document.getElementById("progress-bar").style.width = pct + "%";
    document.getElementById("status-text").innerText = text;
}

function showVideo(url) {
    document.getElementById("processing-ui").classList.add("hidden");
    const vid = document.getElementById("outputVideo");
    vid.src = url;
    vid.classList.remove("hidden");
    vid.play();

    const btn = document.getElementById("generateBtn");
    btn.disabled = false;
    btn.innerText = "Generate Another";
}

function resetUI() {
    document.getElementById("processing-ui").classList.add("hidden");
    document.getElementById("idle-ui").classList.remove("hidden");
    const btn = document.getElementById("generateBtn");
    btn.disabled = false;
    btn.innerText = "Generate Video Free";
}
</script>

</body>
</html>
